# 变更日志

## 1.18.0

### 变更
- 节日判断逻辑优化：移除硬编码的节日日期，改用 `zhdate` 库动态计算公历元旦及农历春节、元宵、端午、中秋等重大节日。
- 依赖更新：新增 `zhdate` 库。

## 1.17.0

### 新增
- 背景图源类型化与等概率选择：支持按“图源”为单位进行等概率选择，图源内部再随机一张图片，避免大数组图源被偏向。
- 支持两类图源类型：
  - `array`：图源自身为图片 URL 数组。
  - `api`：图源为 HTTP 接口，可返回图片数据或图片地址。
- API 图源解析能力：
  - `expected`：支持 `url`（接口返回 JSON，通过路径提取图片地址）或 `image`（接口直接返回图片字节流）。
  - `token`：在 `expected=url` 模式下使用点号分隔路径（例如 `data.url`）提取图片地址，遇到列表会随机选取元素继续解析。
  - `headers`：可在图源中配置请求头（可选），与 `method` 一同用于请求接口。
- 新增示例图源：
  - `alcy_mp`（`api`，`expected=image`）：`https://t.alcy.cc/mp`。
  - `sexphoto`（`api`，`expected=url`，`token=data.url`）：`https://sex.nyan.run/api/v2/`。

### 变更
- 节日好运保底：在元旦及春节日期，幸运指数不低于 70；若同日缓存的幸运指数低于保底值，会自动重新生成并覆盖。
- 背景选择算法重构：由“直接合并全部 URL 后随机”改为“先等概率选择图源，再在图源内随机”，提升选择的公平性与可控性。
